"use strict";(self.webpackChunkcode=self.webpackChunkcode||[]).push([[883],{3905:(e,a,t)=>{t.d(a,{Zo:()=>d,kt:()=>u});var r=t(7294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function n(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a&&(r=r.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?n(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):n(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function s(e,a){if(null==e)return{};var t,r,o=function(e,a){if(null==e)return{};var t,r,o={},n=Object.keys(e);for(r=0;r<n.length;r++)t=n[r],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(r=0;r<n.length;r++)t=n[r],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var p=r.createContext({}),l=function(e){var a=r.useContext(p),t=a;return e&&(t="function"==typeof e?e(a):i(i({},a),e)),t},d=function(e){var a=l(e.components);return r.createElement(p.Provider,{value:a},e.children)},c={inlineCode:"code",wrapper:function(e){var a=e.children;return r.createElement(r.Fragment,{},a)}},m=r.forwardRef((function(e,a){var t=e.components,o=e.mdxType,n=e.originalType,p=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=l(t),u=o,k=m["".concat(p,".").concat(u)]||m[u]||c[u]||n;return t?r.createElement(k,i(i({ref:a},d),{},{components:t})):r.createElement(k,i({ref:a},d))}));function u(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var n=t.length,i=new Array(n);i[0]=m;var s={};for(var p in a)hasOwnProperty.call(a,p)&&(s[p]=a[p]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var l=2;l<n;l++)i[l]=t[l];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}m.displayName="MDXCreateElement"},7794:(e,a,t)=>{t.r(a),t.d(a,{assets:()=>p,contentTitle:()=>i,default:()=>c,frontMatter:()=>n,metadata:()=>s,toc:()=>l});var r=t(7462),o=(t(7294),t(3905));const n={id:"arara_gtech_site",title:"arara.gtech.site"},i=void 0,s={unversionedId:"germantech/arara_gtech_site",id:"germantech/arara_gtech_site",title:"arara.gtech.site",description:"LINK//github.com/lucasbaccan/arara.gtech.site",source:"@site/docs/off/germantech/08_arara_gtech_site.md",sourceDirName:"germantech",slug:"/germantech/arara_gtech_site",permalink:"/off/germantech/arara_gtech_site",draft:!1,editUrl:"https://github.com/lucasbaccan/code/tree/master/docs/off/germantech/08_arara_gtech_site.md",tags:[],version:"current",lastUpdatedBy:"Lucas Elias Baccan",lastUpdatedAt:1680986205,formattedLastUpdatedAt:"8 de abr. de 2023",sidebarPosition:8,frontMatter:{id:"arara_gtech_site",title:"arara.gtech.site"},sidebar:"germantech_sidebar",previous:{title:"AWS Route 53",permalink:"/off/germantech/aws_route53"}},p={},l=[{value:"Como clonar",id:"como-clonar",level:2},{value:"Requisitos",id:"requisitos",level:2},{value:"Containers",id:"containers",level:2},{value:"postgres_db",id:"postgres_db",level:3},{value:"postgres_cron",id:"postgres_cron",level:3},{value:"Rotinas",id:"rotinas",level:4},{value:"pgadmin (opcional)",id:"pgadmin-opcional",level:3},{value:"grafana",id:"grafana",level:3},{value:"prometheus",id:"prometheus",level:3},{value:"postgres_exporter",id:"postgres_exporter",level:3},{value:"node_exporter",id:"node_exporter",level:3},{value:"Como instalar/iniciar o servidor",id:"como-instalariniciar-o-servidor",level:2}],d={toc:l};function c(e){let{components:a,...t}=e;return(0,o.kt)("wrapper",(0,r.Z)({},d,t,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{title:"LINK",type:"tip"},(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("strong",{parentName:"p"},"LINK:")," ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/lucasbaccan/arara.gtech.site"},"https://github.com/lucasbaccan/arara.gtech.site"))),(0,o.kt)("h2",{id:"como-clonar"},"Como clonar"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"git clone https://github.com/lucasbaccan/arara.gtech.site.git\n")),(0,o.kt)("h2",{id:"requisitos"},"Requisitos"),(0,o.kt)("p",null,"Certifique-se que o servidor tenha os seguintes programas instalados:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://git-scm.com/"},"Git")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.docker.com/"},"Docker")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.docker.com/compose/"},"Docker-Compose"))),(0,o.kt)("h2",{id:"containers"},"Containers"),(0,o.kt)("p",null,"Esse projeto sobe alguns containers para o funcionamento do banco de dados. S\xe3o eles:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.postgresql.org/"},"PostgreSQL")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.pgadmin.org/"},"PgAdmin")," (opcional)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://grafana.com/"},"Grafana")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://prometheus.io/"},"Prometheus")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/prometheus-community/postgres_exporter"},"Postgres Exporter")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/prometheus/node_exporter"},"Node Exporter"))),(0,o.kt)("p",null,"A imagem do PostgreSQL \xe9 a oficial do Docker Hub, na vers\xe3o ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/layers/library/postgres/11.16/images/sha256-fdfb434d69d7884d6366840279dc3e721d1bd67cc1d02d51aeea7497f323fc5e?context=explore"},"postgres:11.16"),", o que significa que a vers\xe3o do Postgres \xe9 a 11.16 e o SO \xe9 Debian. J\xe1 o PgAdmin \xe9 a imagem ",(0,o.kt)("a",{parentName:"p",href:"https://hub.docker.com/layers/dpage/pgadmin4/6.13/images/sha256-8f6a7197c89e4817669596b4edac8a21a8d087dadb2a7639ec99999b507f3052"},"dpage/pgadmin4:6.13"),", que \xe9 a vers\xe3o 6.13 do PgAdmin4, que est\xe1 rodando em um SO Alpine."),(0,o.kt)("h3",{id:"postgres_db"},"postgres_db"),(0,o.kt)("p",null,"Esse container \xe9 o banco de dados em si, onde todos os bancos de dados v\xe3o rodar. Todos os dados s\xe3o salvos em um volume, que \xe9 o ",(0,o.kt)("inlineCode",{parentName:"p"},"postgres-db-data:/var/lib/postgresql/data"),", ent\xe3o caso o container seja removido, os dados n\xe3o ser\xe3o perdidos.\nPara configurar, deve ser editado o arquivo ",(0,o.kt)("inlineCode",{parentName:"p"},"env.sh"),", que cont\xe9m as seguintes vari\xe1veis:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"POSTGRES_USER"),": usu\xe1rio do banco de dados"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"POSTGRES_PASSWORD"),": senha do usu\xe1rio do banco de dados"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"POSTGRES_HOST"),": host do banco de dados (deve ser ",(0,o.kt)("inlineCode",{parentName:"li"},"postgres_db"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"POSTGRES_PORT"),": porta do banco de dados (deve ser ",(0,o.kt)("inlineCode",{parentName:"li"},"5432"),")")),(0,o.kt)("h3",{id:"postgres_cron"},"postgres_cron"),(0,o.kt)("p",null,"Esse container utiliza a mesma imagem do ",(0,o.kt)("inlineCode",{parentName:"p"},"postgres_db"),", mas \xe9 utilizado para rodar scripts que precisam dos bin\xe1rios do postgres, mas que n\xe3o precisa ter o banco rodando. Ent\xe3o a rotina de backup, por exemplo, \xe9 rodada nesse container. Todos os dados s\xe3o salvos em um volume do tipo ",(0,o.kt)("em",{parentName:"p"},"bind"),", que \xe9 o ",(0,o.kt)("inlineCode",{parentName:"p"},"./backups/:/backups/"),", que faz com que os arquivos gerados pelo container sejam salvos na pasta ",(0,o.kt)("inlineCode",{parentName:"p"},"backups")," do host.\nPara configurar, deve ser editado o arquivo ",(0,o.kt)("inlineCode",{parentName:"p"},"env.sh"),", que cont\xe9m as seguintes vari\xe1veis:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"POSTGRES_USER"),": usu\xe1rio do banco de dados"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"POSTGRES_PASSWORD"),": senha do usu\xe1rio do banco de dados"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"POSTGRES_HOST"),": host do banco de dados (deve ser ",(0,o.kt)("inlineCode",{parentName:"li"},"postgres_db"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"POSTGRES_PORT"),": porta do banco de dados (deve ser ",(0,o.kt)("inlineCode",{parentName:"li"},"5432"),")"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"S3_BUCKET_BACKUPS"),": bucket do S3 onde os backups ser\xe3o salvos"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"DIRETORIO_SAIDA_BACKUPS"),": diret\xf3rio onde os backups ser\xe3o salvos no container"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"SSH_PASSWORD"),": senha do usu\xe1rio ",(0,o.kt)("inlineCode",{parentName:"li"},"root")," do container ",(0,o.kt)("inlineCode",{parentName:"li"},"postgres_cron"))),(0,o.kt)("h4",{id:"rotinas"},"Rotinas"),(0,o.kt)("p",null,"Todas as rotinas est\xe3o dentro da pasta ",(0,o.kt)("inlineCode",{parentName:"p"},"crontab")," sendo o arquivo ",(0,o.kt)("inlineCode",{parentName:"p"},"crontab")," o arquivo de configura\xe7\xe3o do cron. As rotinas s\xe3o copiadas para o container, basta colocar em ",(0,o.kt)("inlineCode",{parentName:"p"},"crontab/jobs"),"."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/crontab/jobs/backup_todos_bancos.sh"),": faz o backup de todos os bancos de dados do postgres.",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Pode receber um par\xe2metro ",(0,o.kt)("inlineCode",{parentName:"li"},"true"),"ou ",(0,o.kt)("inlineCode",{parentName:"li"},"false"),", que indica se o backup deve ser enviado para o S3 ou n\xe3o. Por padr\xe3o n\xe3o \xe9 enviado."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"/crontab/jobs/drop_loop.sh"),": verifica as conex\xf5es indevidas no banco de dados e mata elas.")),(0,o.kt)("h3",{id:"pgadmin-opcional"},"pgadmin (opcional)"),(0,o.kt)("p",null,"Este container \xe9 opcional, e serve para facilitar a visualiza\xe7\xe3o dos bancos de dados. Ele \xe9 acessado atrav\xe9s do endere\xe7o ",(0,o.kt)("inlineCode",{parentName:"p"},"http://IP-SERVIDOR:8080"),", e o usu\xe1rio e senha padr\xe3o s\xe3o ",(0,o.kt)("inlineCode",{parentName:"p"},"admin@admin.com")," e ",(0,o.kt)("inlineCode",{parentName:"p"},"admin"),", respectivamente. "),(0,o.kt)("h3",{id:"grafana"},"grafana"),(0,o.kt)("p",null,"Esse container \xe9 o respons\xe1vel por exibir os gr\xe1ficos de m\xe9tricas do Prometheus. Ele \xe9 acessado atrav\xe9s do endere\xe7o ",(0,o.kt)("inlineCode",{parentName:"p"},"http://IP-SERVIDOR:3000"),", e o usu\xe1rio e senha padr\xe3o s\xe3o ",(0,o.kt)("inlineCode",{parentName:"p"},"admin")," e ",(0,o.kt)("inlineCode",{parentName:"p"},"admin"),", respectivamente. No primeiro login da para alterar a senha."),(0,o.kt)("h3",{id:"prometheus"},"prometheus"),(0,o.kt)("p",null,"Esse container \xe9 o respons\xe1vel por coletar as m\xe9tricas dos bancos de dados e dos containers. O padr\xe3o seria exportar a porta 9090, mas ela s\xf3 \xe9 vis\xedvel para os containers."),(0,o.kt)("h3",{id:"postgres_exporter"},"postgres_exporter"),(0,o.kt)("p",null,"Esse container \xe9 o respons\xe1vel por exportar as m\xe9tricas do banco de dados para o Prometheus. O padr\xe3o seria exportar a porta 9187, mas ela s\xf3 \xe9 vis\xedvel para os containers."),(0,o.kt)("h3",{id:"node_exporter"},"node_exporter"),(0,o.kt)("p",null,"Esse container \xe9 o respons\xe1vel por exportar as m\xe9tricas do servidor para o Prometheus. O padr\xe3o seria exportar a porta 9100, mas ela s\xf3 \xe9 vis\xedvel para os containers."),(0,o.kt)("h2",{id:"como-instalariniciar-o-servidor"},"Como instalar/iniciar o servidor"),(0,o.kt)("p",null,"Ap\xf3s o clone do projeto, vai existir alguns arquivos ",(0,o.kt)("inlineCode",{parentName:"p"},".sh"),", basta executar eles:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Configura\xe7\xe3o"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"env.sh"),": arquivo de configura\xe7\xe3o do ambiente do servidor."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ssh_key_generate.sh"),": script para gerar a chave SSH para o container ",(0,o.kt)("inlineCode",{parentName:"li"},"postgres_cron"),"."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"criar_ambiente.sh"),": script para criar o ambiente do servidor, utilizado na primeira vez."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Status do servidor"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"start.sh"),": script para iniciar o servidor (pode passar o par\xe2metro ",(0,o.kt)("inlineCode",{parentName:"li"},"true")," para ver o log."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"stop.sh"),": script para parar o servidor."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"restart.sh"),": script para reiniciar o servidor."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},"Restaurar backup"),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"restore.sh"),": script para restaurar os backups do S3."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"restore_stop.sh"),": script para parar o script de restaura\xe7\xe3o."),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"restore_continue.sh"),": script para continuar o script de restaura\xe7\xe3o.")))))}c.isMDXComponent=!0}}]);