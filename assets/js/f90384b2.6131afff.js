"use strict";(self.webpackChunkcode=self.webpackChunkcode||[]).push([[6887],{5571:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>d,contentTitle:()=>a,default:()=>t,frontMatter:()=>i,metadata:()=>c,toc:()=>l});var s=n(5893),r=n(1151);n(4985);const i={id:"index",title:"Day 6",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Day 6"},a=void 0,c={id:"pick-2024/docker/day6/index",title:"Day 6",description:"Sum\xe1rio",source:"@site/docs/cursos/pick-2024/docker/day6/index.md",sourceDirName:"pick-2024/docker/day6",slug:"/pick-2024/docker/day6/",permalink:"/cursos/pick-2024/docker/day6/",draft:!1,unlisted:!1,editUrl:"https://github.com/lucasbaccan/code/tree/master/docs/cursos/pick-2024/docker/day6/index.md",tags:[],version:"current",lastUpdatedBy:"Lucas Elias Baccan",lastUpdatedAt:1731361657e3,frontMatter:{id:"index",title:"Day 6",hide_title:!1,hide_table_of_contents:!1,sidebar_label:"Day 6"},sidebar:"docs",previous:{title:"Day 5",permalink:"/cursos/pick-2024/docker/day5/"},next:{title:"Day 1",permalink:"/cursos/pick-2024/kubernets/day1/"}},d={},l=[{value:"Sum\xe1rio",id:"sum\xe1rio",level:2},{value:"Dia 6",id:"dia-6",level:2},{value:"O que \xe9 Docker Compose?",id:"o-que-\xe9-docker-compose",level:3},{value:"Criando e conectando mais de um container com o Compose",id:"criando-e-conectando-mais-de-um-container-com-o-compose",level:3},{value:"Utilizando Volumes com o Docker Compose",id:"utilizando-volumes-com-o-docker-compose",level:3},{value:"Dockerfile + Docker Compose",id:"dockerfile--docker-compose",level:3},{value:"Scale",id:"scale",level:3},{value:"Reservando e definindo recursos como CPU e mem\xf3ria",id:"reservando-e-definindo-recursos-como-cpu-e-mem\xf3ria",level:3},{value:"Depend\xeancias e Healthcheck",id:"depend\xeancias-e-healthcheck",level:3},{value:"Desafio",id:"desafio",level:2},{value:"Objetivo",id:"objetivo",level:3},{value:"Solu\xe7\xe3o",id:"solu\xe7\xe3o",level:3}];function m(e){const o={a:"a",admonition:"admonition",br:"br",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.h2,{id:"sum\xe1rio",children:"Sum\xe1rio"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - Intro - 03:47"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - O meu primeiro Docker Compose - 12:49"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - Criando e conectando mais de um container com o Compose - 11:18"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - Utilizando Volumes com o Docker Compose - 09:26"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - Buildando uma imagem de container com o Compose e aumentando o n\xfamero de r\xe9plicas - 09:24"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - Reservando e definindo recursos como CPU e mem\xf3ria - 08:29"}),"\n",(0,s.jsx)(o.li,{children:"\ud83d\udcdd Teste te\xf3rico Day6 - 5 quest\xf5es"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - Usando Healthcheck no Docker Compose - 13:47"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - Docker Compose review avan\xe7ado - 48:16"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Opa, esse Jeferson... - 00:52"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udfa5 Day6 - Encerramento - 01:51"}),"\n",(0,s.jsx)(o.li,{children:"\ud83d\udcdd Exame Te\xf3rico do Day6 - 13 quest\xf5es"}),"\n",(0,s.jsx)(o.li,{children:"\ud83d\udcdd Desafio Day6 - Docker Compose"}),"\n",(0,s.jsx)(o.li,{children:"\u231b Feedback"}),"\n",(0,s.jsx)(o.li,{children:"\ud83c\udf99\ufe0f Sess\xe3o ao Vivo - 06/04/2024"}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:[(0,s.jsx)(o.strong,{children:"Legenda"}),(0,s.jsx)(o.br,{}),"\n","\ud83c\udf99\ufe0f - Aula ao Vivo\n\ud83c\udfa5 - Aula gravada\n\ud83d\udcdd - Atividade\n\u231b - Revis\xe3o/Reflex\xe3o"]}),"\n",(0,s.jsx)(o.h2,{id:"dia-6",children:"Dia 6"}),"\n",(0,s.jsx)(o.p,{children:"Day 6 foi sobre Docker Compose, onde aprendemos a criar e conectar mais de um container com o Compose, utilizar Volumes com o Docker Compose, buildar uma imagem de container com o Compose e aumentar o n\xfamero de r\xe9plicas, reservar e definir recursos como CPU e mem\xf3ria, usar Healthcheck no Docker Compose e revis\xe3o avan\xe7ada do Docker Compose."}),"\n",(0,s.jsx)(o.h3,{id:"o-que-\xe9-docker-compose",children:"O que \xe9 Docker Compose?"}),"\n",(0,s.jsx)(o.p,{children:"Docker Compose \xe9 um plugin do Docker que permite definir e executar aplicativos Docker multicontainer. Com ele, \xe9 poss\xedvel definir os servi\xe7os, redes e volumes de um aplicativo em um arquivo YAML, e com um \xfanico comando, \xe9 poss\xedvel criar e iniciar todos os servi\xe7os definidos no arquivo."}),"\n",(0,s.jsx)(o.admonition,{type:"info",children:(0,s.jsxs)(o.p,{children:["P\xe1gina oficial do ",(0,s.jsx)(o.a,{href:"https://docs.docker.com/compose/",children:"Docker Compose"})]})}),"\n",(0,s.jsxs)(o.p,{children:["Vamos criar um arquivo de exemplo chamado ",(0,s.jsx)(o.code,{children:"compose.yml"}),":"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:"showLineNumbers",children:'services:\n  nginx:\n    image: nginx:latest\n    ports:\n      - "8080:80"\n'})}),"\n",(0,s.jsx)(o.p,{children:"E para rodar o arquivo, basta executar o comando:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"docker-compose up\n# ou\ndocker-compose up -d # para rodar em background\n"})}),"\n",(0,s.jsx)(o.h3,{id:"criando-e-conectando-mais-de-um-container-com-o-compose",children:"Criando e conectando mais de um container com o Compose"}),"\n",(0,s.jsxs)(o.p,{children:["Vamos criar um arquivo ",(0,s.jsx)(o.code,{children:"compose.yml"})," com dois servi\xe7os: ",(0,s.jsx)(o.code,{children:"giropops-senhas"})," e ",(0,s.jsx)(o.code,{children:"redis"}),":"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:"showLineNumbers",children:'services:\n  giropops-senhas:\n    image: linuxtips/giropops-senhas:1.0\n    ports:\n      - "5000:5000"\n    environment:\n      - REDIS_HOST=redis\n    networks:\n      - giropops\n  redis:\n    image: redis\n    ports:\n      - "6379:6379"\n    networks:\n      - giropops\n\nnetworks:\n  giropops:\n    driver: bridge\n'})}),"\n",(0,s.jsx)(o.p,{children:"E para rodar o arquivo, basta executar o comando:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"docker-compose up\n"})}),"\n",(0,s.jsxs)(o.p,{children:["Assim os containers ",(0,s.jsx)(o.code,{children:"giropops-senhas"})," e ",(0,s.jsx)(o.code,{children:"redis"})," estar\xe3o conectados em uma Network chamada ",(0,s.jsx)(o.code,{children:"giropops"}),"."]}),"\n",(0,s.jsxs)(o.p,{children:["Por padr\xe3o, o Docker cria um DNS interno para os containers, ent\xe3o \xe9 poss\xedvel acessar o container pelo nome do container, no caso acima, o ",(0,s.jsx)(o.code,{children:"giropops-senhas"})," acessa o ",(0,s.jsx)(o.code,{children:"redis"})," pelo nome ",(0,s.jsx)(o.code,{children:"redis"}),"."]}),"\n",(0,s.jsx)(o.h3,{id:"utilizando-volumes-com-o-docker-compose",children:"Utilizando Volumes com o Docker Compose"}),"\n",(0,s.jsxs)(o.p,{children:["Vamos criar um arquivo ",(0,s.jsx)(o.code,{children:"compose.yml"})," com um volume:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:"showLineNumbers",children:'services:\n  giropops-senhas:\n    image: linuxtips/giropops-senhas:1.0\n    ports:\n      - "5000:5000"\n    environment:\n      - REDIS_HOST=redis\n    volumes:\n      - ./app:/app\n      - app_data:/app_data\n\n  redis:\n    image: redis\n    ports:\n      - "6379:6379"\n\nvolumes:\n  app_data:\n'})}),"\n",(0,s.jsx)(o.p,{children:"E para rodar o arquivo, basta executar o comando:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"docker-compose up\n"})}),"\n",(0,s.jsxs)(o.p,{children:["O volume ",(0,s.jsx)(o.code,{children:"app_data"})," ser\xe1 criado automaticamente e o diret\xf3rio ",(0,s.jsx)(o.code,{children:"./app"})," ser\xe1 montado no container ",(0,s.jsx)(o.code,{children:"giropops-senhas"}),". Esses volumes s\xe3o persistentes, ou seja, os dados n\xe3o ser\xe3o perdidos quando o container for removido."]}),"\n",(0,s.jsx)(o.h3,{id:"dockerfile--docker-compose",children:"Dockerfile + Docker Compose"}),"\n",(0,s.jsxs)(o.p,{children:["Vamos criar um arquivo ",(0,s.jsx)(o.code,{children:"Dockerfile"})," para buildar uma imagem de container:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-Dockerfile",metastring:"showLineNumbers",children:"FROM nginx:latest\nCOPY index.html /usr/share/nginx/html/index.html\n"})}),"\n",(0,s.jsxs)(o.p,{children:["E um arquivo ",(0,s.jsx)(o.code,{children:"compose.yml"})," para buildar a imagem e aumentar o n\xfamero de r\xe9plicas:"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:"showLineNumbers",children:'services:\n  web:\n    build: .\n    ports:\n      - "8080:80"\n'})}),"\n",(0,s.jsx)(o.p,{children:"E para rodar o arquivo, basta executar o comando:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"docker-compose up \n"})}),"\n",(0,s.jsxs)(o.p,{children:["Isso far\xe1 o build da imagem e rodar\xe1 o container ",(0,s.jsx)(o.code,{children:"web"})," com a imagem a partir do ",(0,s.jsx)(o.code,{children:"Dockerfile"}),"."]}),"\n",(0,s.jsx)(o.h3,{id:"scale",children:"Scale"}),"\n",(0,s.jsx)(o.p,{children:"Para aumentar o n\xfamero de r\xe9plicas de um servi\xe7o, basta executar o comando:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-bash",children:"docker-compose up --scale web=3\n"})}),"\n",(0,s.jsxs)(o.p,{children:["Isso criar\xe1 3 r\xe9plicas do servi\xe7o ",(0,s.jsx)(o.code,{children:"web"}),"."]}),"\n",(0,s.jsxs)(o.p,{children:["Voc\xea pode definir a quantidade de r\xe9plicas no arquivo ",(0,s.jsx)(o.code,{children:"compose.yml"}),":"]}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:"showLineNumbers",children:"services:\n  web:\n    image: nginx:latest\n    scale: 3\n"})}),"\n",(0,s.jsx)(o.p,{children:"or"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:"showLineNumbers",children:"services:\n  web:\n    image: nginx:latest\n    deploy:\n      replicas: 3\n    update_config:\n      parallelism: 2\n      delay: 10s\n"})}),"\n",(0,s.jsx)(o.h3,{id:"reservando-e-definindo-recursos-como-cpu-e-mem\xf3ria",children:"Reservando e definindo recursos como CPU e mem\xf3ria"}),"\n",(0,s.jsx)(o.p,{children:"Podemos definir um limite de CPU e mem\xf3ria para um container ou uma reserva de recursos:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:"showLineNumbers",children:"services:\n  giropops-senhas:\n    image: linuxtips/giropops-senhas:1.0\n    ports:\n      - \"5000:5000\"\n    environment:\n      - REDIS_HOST=redis\n    deploy:\n      resources:\n        limits:\n          cpus: '0.5'\n          memory: '128m'\n        reservations:\n          cpus: '0.2'\n          memory: '64m'\n"})}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.strong,{children:"limits"}),": limita a quantidade de CPUs e mem\xf3ria que o container pode usar."]}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.strong,{children:"reservations"}),": define a quantidade de CPUs e mem\xf3ria que o container reserva."]}),"\n"]}),"\n",(0,s.jsx)(o.h3,{id:"depend\xeancias-e-healthcheck",children:"Depend\xeancias e Healthcheck"}),"\n",(0,s.jsx)(o.p,{children:"Podemos definir depend\xeancias entre os servi\xe7os e utilizar Healthcheck para verificar se o servi\xe7o est\xe1 saud\xe1vel:"}),"\n",(0,s.jsx)(o.pre,{children:(0,s.jsx)(o.code,{className:"language-yaml",metastring:"showLineNumbers",children:'services:\n  giropops-senhas:\n    image: linuxtips/giropops-senhas:1.0\n    ports:\n      - "5000:5000"\n    environment:\n      - REDIS_HOST=redis\n    depends_on:\n      - redis\n\n  redis:\n    image: redis\n    ports:\n      - "6379:6379"\n    healthcheck:\n      test: ["CMD", "redis-cli", "ping"]\n      interval: 1m\n      timeout: 10s\n      retries: 3\n      start_period: 10s\n'})}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.strong,{children:"depends_on"}),": define a ordem de inicializa\xe7\xe3o dos servi\xe7os."]}),"\n",(0,s.jsxs)(o.li,{children:[(0,s.jsx)(o.strong,{children:"healthcheck"}),": define um comando para verificar se o servi\xe7o est\xe1 saud\xe1vel. Se o servi\xe7o n\xe3o estiver saud\xe1vel, os containers que dependem dele n\xe3o ser\xe3o iniciados."]}),"\n"]}),"\n",(0,s.jsx)(o.admonition,{type:"info",children:(0,s.jsxs)(o.p,{children:["Para mais informa\xe7\xf5es sobre Healthcheck, acesse a ",(0,s.jsx)(o.a,{href:"https://docs.docker.com/compose/compose-file/compose-file-v3/#healthcheck",children:"documenta\xe7\xe3o oficial"}),"."]})}),"\n",(0,s.jsx)(o.h2,{id:"desafio",children:"Desafio"}),"\n",(0,s.jsx)(o.h3,{id:"objetivo",children:"Objetivo"}),"\n",(0,s.jsx)(o.p,{children:'Para tornar o desafio ainda mais interessante e educativo, vamos adicionar alguns "empecilhos" ao arquivo docker-compose.yml. Voc\xeas ter\xe3o que identificar e corrigir esses problemas para que a aplica\xe7\xe3o Giropops Senhas funcione corretamente.'}),"\n",(0,s.jsx)(o.h3,{id:"solu\xe7\xe3o",children:"Solu\xe7\xe3o"}),"\n",(0,s.jsx)(o.p,{children:"O arquivo docker file tinha v\xe1rios erros, dentre eles:"}),"\n",(0,s.jsxs)(o.ul,{children:["\n",(0,s.jsx)(o.li,{children:"Servi\xe7o sem imagem"}),"\n",(0,s.jsx)(o.li,{children:"Porta do servi\xe7o com espa\xe7o entre os valores"}),"\n",(0,s.jsx)(o.li,{children:"Network com nome errado"}),"\n",(0,s.jsx)(o.li,{children:"Volume com nome errado e tipo errado"}),"\n",(0,s.jsx)(o.li,{children:"N\xe3o definido environment para o servi\xe7o giropops-senhas"}),"\n",(0,s.jsx)(o.li,{children:"Driver de rede incorreto"}),"\n",(0,s.jsx)(o.li,{children:"Typo de volume incorreto"}),"\n"]}),"\n",(0,s.jsxs)(o.p,{children:["Ap\xf3s realizar as corre\xe7\xf5es, o comando ",(0,s.jsx)(o.code,{children:"docker-compose up"})," foi executado e a aplica\xe7\xe3o Giropops Senhas funcionou corretamente."]})]})}function t(e={}){const{wrapper:o}={...(0,r.a)(),...e.components};return o?(0,s.jsx)(o,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},4985:(e,o,n)=>{n.d(o,{Z:()=>r});n(7294);var s=n(5893);function r(e){let{children:o,fontSize:n="15px",color:r="#999"}=e;return(0,s.jsx)("div",{style:{textAlign:"center",fontSize:n,color:r},children:o})}},1151:(e,o,n)=>{n.d(o,{Z:()=>c,a:()=>a});var s=n(7294);const r={},i=s.createContext(r);function a(e){const o=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function c(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(i.Provider,{value:o},e.children)}}}]);